# CloudFront Video Streaming - Backend Fix

## Task
Update the video stream URL API to use **AWS CloudFront signed URLs** instead of direct S3 pre-signed URLs.

## Tech Stack
- **Runtime:** Bun
- **Language:** TypeScript
- **ORM:** Prisma (MongoDB)

## Requirements

1. **Install dependency:**
   ```bash
   bun add @aws-sdk/cloudfront-signer
   ```

2. **Add environment variables** (I'll provide values):
   ```env
   CLOUDFRONT_DOMAIN=d1hthlo9rex9uc.cloudfront.netCLOUDFRONT_KEY_PAIR_ID=K37OSO4QCMNTPG
   CLOUDFRONT_PRIVATE_KEY=-LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZB
   QVNDQktnd2dnU2tBZ0VBQW9JQkFRRE1Jd3oybURCMWZpYXoKSTdQR0EyNURqY05KQnZKbXNBdE9F
   VSt4bkRhYm1rU3V5cFQ3cVhjYVg2NVYrUkNBSmIzUmU3Q0pkUDlTVTEvdQpoUTNRMXg4SHVFVU0w
   WjlFeUFVYW93MWRxTGE3VGIwZk5PNGs5SUY2WHVGWmFzQUVnWW9XZU1VMVpGRTJ0K3pkCkhQdGpr
   Y3hnZHZpUUVjT0U4ZTI2UXl4bm14L203ZDc1VStWSmV0aVk1MHZseUMzbnNIVTJOK0ZtWG5IOTJ6
   Zk8KV0hIa3NrenVUV0RIVHNUdWc1REV5TVJYMmFMK0xzajh5UDZ0ZmhFWnhPT2swU2dXcmdobXN0
   ZDRZNkRZQjhneQo5dzVtRHp4ZmJtQmM5dVlJME9nWDhwclJGazJvWmdaQzdrRCtkVkVaaTJsR1M4
   d3BLR3k2WlkreC92SEM1ZmxmClVINEJVak4vQWdNQkFBRUNnZ0VBVm1pYnl5SCttUzFOK2xRcGU2
   N21GS2hFT253N1RTWkZrc1VYSThwSS96S2MKMGhRa1hpYU1xTmhKZGxEWUlEWlprL3UwYldyZHpK
   NUlKREdqK0h1bXdlREpNYlRsb3ZxNzFsdWdnNzJ2bzdjegpUNnRiQnIrTXN4ekliTTRYKzVCTndG
   ZGN1czM4NXBtU0pNSm8wdXZiUkJYMy94dlYxRWVINW1rYXVieGJFNmRwCkhHQUJENyttSS81MGxV
   SVc0UjY3SFBTYm84aEdwREJDYkdmU3dtL3AyZFFlRU94aVFoNzVuTG9ESzhOdHozVEIKR2dudEVS
   SkdVTlpzN0thMS9hUzhNaHAzZDE3L3VCWmd3R2VveWM0VlhWQVV6TnRsdlJzVWp0eG90T2NJSUx1
   YwpGTWliOXdOV09uQmFBNnU2ckJhKytqMUk2ZWRORmhVT3lIeW5oSVJkZ1FLQmdRRHV6T044OWpO
   Q3Q4aWdXRi9NCmN2Ni8zSmMzMmdqR3BhNjVTaVoxeU9FbEk3R0I5blNiOGpjTC90N2NlVmZvQkF0
   M1ovNVlJdTZvQ3Zmd1MxMmcKQlh2Zk1wY2hNcnZGWURML2JXMGZwRVN4aUh2S3k2WTNwdG5hOGlI
   T3kyRE5XeVNnVU9NKzFqdk8vc1NOOGdnWQo2KzNuM0hZVm5NK0FEUHJUMkRzaEcvczl2d0tCZ1FE
   YTF3V0tiUVVSeWpwemNvd2poZmtXSmRVSlFua0hKdFRaCklhQmFUdE1MYUdjSDAxNEo5S01uMXFY
   ZDljc1NLcGNTZ2gwS0F5SUlzaHNEcDZ4TUxwY2czTnZLeDFoRFdXNjcKRzAxVVExdEdzZCtzc2JI
   MXBjYVJ4RmowUHNkWktHamNHL09CcUYxcHVjaHBnaE5neHduMy81SGtZWUF1bEwzawpoT0lTaUlY
   NlFRS0JnUURRRkhSOVpNS1I5amE1a1lnWVRIT3lsdktsVmpXamNxZG5DVGV1RnBZb21JdUtKVWpD
   CndqSTVINkx1RmtZRkE5RkNBTG5kN3NKcVp2Ull6RE1PeHZpREtrQUtTM3pXcGRhS1A3MkFmdERr
   cVhyRTRPTTcKUndZNkJCWjFiVDR5Y3FMZGx0NE0yUHhRaUNxWlRUYkZFSC9ETTVVcGkvUTdMaFE2
   R0FhZCtSWFpYUUtCZ0JodgpwaWk4MzdJSzJOZ0hWR3FyRFJOU0NpWE1qR01tRE9KcUJOUFF0WFF5
   cGo2VGRZNjdDSFRzWFAwWjh5RUdMSFJlCm53dDlLaEc2Z1pXNDVWNWtYVy9IK2FyODgzZ2h4bUdT
   UE9KSjJ5bGJ0MVE3UzFuWXR3R1Q0VEwweDZISEIxNTgKcUlZejNLcHZtbGRkdFBnN2dYdDF5RDZ1
   UEhmM0YvVXFlV3dFWHFHQkFvR0JBTzBVVm1OOTIwU0Q0MUlMaWRCNAp5ZURCOEYwL0dsdEkvc0k3
   WkxMWHBYNDFzRFdEVE51NE9KdkU2VWpvLzBRUXB5cHRXaVJHc1pqV1ovZmVia3FlCnJ2bU01ejk1
   b21QdkIrWkxxQTQ5UG5Bb05BY0NEdkdNbEZ1V2RqNFZ0djY5bS9pZE53cmwvQk4wY2dOSWYvUmwK
   REdtUjliRUh4YTFFbVlKZ2RIMlNjT1lSCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
   ```

3. **Create a utility function** for generating CloudFront signed URLs:
   - Use `@aws-sdk/cloudfront-signer` package
   - Set URL expiration to 4 hours
   - Accept video path as parameter

4. **Update the stream URL endpoint:**
   - Find the existing endpoint that returns video URLs (likely `/api/stream-url/:lectureId` or similar)
   - Replace S3 pre-signed URL generation with CloudFront signed URL
   - Keep the same response format: `{ url: string, expiresIn?: number }`

## Important
- **DO NOT** modify Prisma schema or database queries
- **DO NOT** change authentication/authorization logic
- **DO NOT** alter the API route structure
- **ONLY** update the URL generation logic

## Expected Output
The API should return URLs like:
```
https://d1234.cloudfront.net/videos/lecture.mp4?Policy=...&Signature=...&Key-Pair-Id=...
```

Instead of:
```
https://bucket.s3.region.amazonaws.com/videos/lecture.mp4?X-Amz-Signature=...
```

## Env Variables (Fill These In)
```env
   # CloudFront Distribution
   CLOUDFRONT_DOMAIN=d1hthlo9rex9uc.cloudfront.net

   # Key Pair ID from CloudFront Console
   CLOUDFRONT_KEY_PAIR_ID=K37OSO4QCMNTPG
   # Base64 encoded private key (run: base64 -w 0 cloudfront-private-key.pem)
   CLOUDFRONT_PRIVATE_KEY=LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZB
   QVNDQktnd2dnU2tBZ0VBQW9JQkFRRE1Jd3oybURCMWZpYXoKSTdQR0EyNURqY05KQnZKbXNBdE9F
   VSt4bkRhYm1rU3V5cFQ3cVhjYVg2NVYrUkNBSmIzUmU3Q0pkUDlTVTEvdQpoUTNRMXg4SHVFVU0w
   WjlFeUFVYW93MWRxTGE3VGIwZk5PNGs5SUY2WHVGWmFzQUVnWW9XZU1VMVpGRTJ0K3pkCkhQdGpr
   Y3hnZHZpUUVjT0U4ZTI2UXl4bm14L203ZDc1VStWSmV0aVk1MHZseUMzbnNIVTJOK0ZtWG5IOTJ6
   Zk8KV0hIa3NrenVUV0RIVHNUdWc1REV5TVJYMmFMK0xzajh5UDZ0ZmhFWnhPT2swU2dXcmdobXN0
   ZDRZNkRZQjhneQo5dzVtRHp4ZmJtQmM5dVlJME9nWDhwclJGazJvWmdaQzdrRCtkVkVaaTJsR1M4
   d3BLR3k2WlkreC92SEM1ZmxmClVINEJVak4vQWdNQkFBRUNnZ0VBVm1pYnl5SCttUzFOK2xRcGU2
   N21GS2hFT253N1RTWkZrc1VYSThwSS96S2MKMGhRa1hpYU1xTmhKZGxEWUlEWlprL3UwYldyZHpK
   NUlKREdqK0h1bXdlREpNYlRsb3ZxNzFsdWdnNzJ2bzdjegpUNnRiQnIrTXN4ekliTTRYKzVCTndG
   ZGN1czM4NXBtU0pNSm8wdXZiUkJYMy94dlYxRWVINW1rYXVieGJFNmRwCkhHQUJENyttSS81MGxV
   SVc0UjY3SFBTYm84aEdwREJDYkdmU3dtL3AyZFFlRU94aVFoNzVuTG9ESzhOdHozVEIKR2dudEVS
   SkdVTlpzN0thMS9hUzhNaHAzZDE3L3VCWmd3R2VveWM0VlhWQVV6TnRsdlJzVWp0eG90T2NJSUx1
   YwpGTWliOXdOV09uQmFBNnU2ckJhKytqMUk2ZWRORmhVT3lIeW5oSVJkZ1FLQmdRRHV6T044OWpO
   Q3Q4aWdXRi9NCmN2Ni8zSmMzMmdqR3BhNjVTaVoxeU9FbEk3R0I5blNiOGpjTC90N2NlVmZvQkF0
   M1ovNVlJdTZvQ3Zmd1MxMmcKQlh2Zk1wY2hNcnZGWURML2JXMGZwRVN4aUh2S3k2WTNwdG5hOGlI
   T3kyRE5XeVNnVU9NKzFqdk8vc1NOOGdnWQo2KzNuM0hZVm5NK0FEUHJUMkRzaEcvczl2d0tCZ1FE
   YTF3V0tiUVVSeWpwemNvd2poZmtXSmRVSlFua0hKdFRaCklhQmFUdE1MYUdjSDAxNEo5S01uMXFY
   ZDljc1NLcGNTZ2gwS0F5SUlzaHNEcDZ4TUxwY2czTnZLeDFoRFdXNjcKRzAxVVExdEdzZCtzc2JI
   MXBjYVJ4RmowUHNkWktHamNHL09CcUYxcHVjaHBnaE5neHduMy81SGtZWUF1bEwzawpoT0lTaUlY
   NlFRS0JnUURRRkhSOVpNS1I5amE1a1lnWVRIT3lsdktsVmpXamNxZG5DVGV1RnBZb21JdUtKVWpD
   CndqSTVINkx1RmtZRkE5RkNBTG5kN3NKcVp2Ull6RE1PeHZpREtrQUtTM3pXcGRhS1A3MkFmdERr
   cVhyRTRPTTcKUndZNkJCWjFiVDR5Y3FMZGx0NE0yUHhRaUNxWlRUYkZFSC9ETTVVcGkvUTdMaFE2
   R0FhZCtSWFpYUUtCZ0JodgpwaWk4MzdJSzJOZ0hWR3FyRFJOU0NpWE1qR01tRE9KcUJOUFF0WFF5
   cGo2VGRZNjdDSFRzWFAwWjh5RUdMSFJlCm53dDlLaEc2Z1pXNDVWNWtYVy9IK2FyODgzZ2h4bUdT
   UE9KSjJ5bGJ0MVE3UzFuWXR3R1Q0VEwweDZISEIxNTgKcUlZejNLcHZtbGRkdFBnN2dYdDF5RDZ1
   UEhmM0YvVXFlV3dFWHFHQkFvR0JBTzBVVm1OOTIwU0Q0MUlMaWRCNAp5ZURCOEYwL0dsdEkvc0k3
   WkxMWHBYNDFzRFdEVE51NE9KdkU2VWpvLzBRUXB5cHRXaVJHc1pqV1ovZmVia3FlCnJ2bU01ejk1
   b21QdkIrWkxxQTQ5UG5Bb05BY0NEdkdNbEZ1V2RqNFZ0djY5bS9pZE53cmwvQk4wY2dOSWYvUmwK
   REdtUjliRUh4YTFFbVlKZ2RIMlNjT1lSCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
```
